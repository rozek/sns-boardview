import{allowTextline as e,allowListSatisfying as t,allowOneOf as n,allowOrdinal as i,allowFunction as o,allowText as r,allowBoolean as s,allowCardinal as a,allowInteger as l}from"javascript-interface-library";import{allowBoard as d,ValueIsSticker as c,CSSStyleOfVisual as h}from"shareable-note-stickers";import u from"svelte-coordinate-conversion";import{Component as S,html as p}from"htm/preact";import{DragClickRecognizerFor as g,DragRecognizerFor as _}from"protoux";function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},m.apply(null,arguments)}function k(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;n[i]=e[i]}return n}const f=["Sticker","onPointerEvent"],$=["Mode","Geometry","onPointerEvent"];let x,b,y,v,M,w,D,C,G,E,P,N,L,H,z,W,B,R,F=e=>e;const{fromDocumentTo:V}=u,T=document.createElement("style");T.setAttribute("id","SNS Stylesheet"),T.innerHTML="/*******************************************************************************\n*                                                                              *\n*                        Shareable Note Stickers (SNS)                         *\n*                                                                              *\n*******************************************************************************/\n\n/**** all SNS elements are absolutely positioned ****/\n\n  .SNS {\n    display:block; position:absolute;\n    margin:0px; padding:0px;\n    background:none; border:none; border-radius:0px; outline:none;\n  }\n\n/**** elements of class \"SNS Content\" cover their whole container ****/\n\n  .SNS.Content {\n    display:block; position:absolute;\n    left:0px; top:0px; width:100%; height:100%;\n  }\n\n/**** \"brokenSticker\" and Error Indicator ****/\n\n  .SNS.brokenSticker {\n    overflow:hidden;\n    border:dotted 1px orange; background:rgba(255,0,0,0.1);\n  }\n\n  .SNS.ErrorIndicator {\n    overflow:hidden;\n    left:0px; top:0px; width:24px; height:24px;\n    background:url(\"data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3Csvg width='24px' height='24px' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 17.0001H12.01M12 10.0001V14.0001M6.41209 21.0001H17.588C19.3696 21.0001 20.2604 21.0001 20.783 20.6254C21.2389 20.2985 21.5365 19.7951 21.6033 19.238C21.6798 18.5996 21.2505 17.819 20.3918 16.2579L14.8039 6.09805C13.8897 4.4359 13.4326 3.60482 12.8286 3.32987C12.3022 3.09024 11.6978 3.09024 11.1714 3.32987C10.5674 3.60482 10.1103 4.4359 9.19614 6.09805L3.6082 16.2579C2.74959 17.819 2.32028 18.5996 2.39677 19.238C2.46351 19.7951 2.76116 20.2985 3.21709 20.6254C3.7396 21.0001 4.63043 21.0001 6.41209 21.0001Z' stroke='orange' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' fill='white'/%3E%3C/svg%3E\");\n    pointer-events:auto;\n  }\n\n\n/**** BoardView ****/\n\n  .SNS.BoardView {\n    left:0px; top:0px; right:0px; bottom:0px;\n  }\n\n/**** Sticker and Contents, Cover ****/\n\n  .SNS.Sticker {}\n  .SNS.Sticker > .SNS {\n    -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none;\n    user-select:none;\n\n    display:block; position:absolute;\n    left:0px; top:0px; width:100%; height:100%; right:auto; bottom:auto;\n  }\n\n  .SNS.Cover {\n    -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none;\n    user-select:none;\n\n    z-index:1000000;\n  }\n\n/**** Selection Markers ****/\n\n  .SNS.Sticker.selected, .SNS.Cover[selected] {\n    outline:dotted 2px orangered;\n  }\n\n  .SNS.ShapeHandle {\n    width:8px; height:8px;\n    background:orangered; border:solid 1px darkgray;\n    z-index:1000001; /* above .SNS.Cover */\n  }\n\n/**** Selection Lasso ****/\n\n  .SNS.Lasso {\n    background:rgba(255,69,0, 0.1); /* border:dashed 2px orangered; */\n  }\n\n/**** Dragging Guides ****/\n\n  .SNS.horizontalGuide.Edge {\n    left:0px; right:0px; height:1px;\n    border-top:dashed 1px orangered;\n  }\n  .SNS.verticalGuide.Edge {\n    top:0px; bottom:0px; width:1px;\n    border-left:dashed 1px orangered;\n  }\n\n  .SNS.horizontalGuide.Center {\n    left:0px; right:0px; height:1px;\n    border-top:dotted 1px orangered;\n  }\n  .SNS.verticalGuide.Center {\n    top:0px; bottom:0px; width:1px;\n    border-left:dotted 1px orangered;\n  }\n\n/**** Placeholder ****/\n\n  .SNS.Placeholder {\n    display:block; position:relative;\n    width:100%; height:100%;\n  }\n\n  .SNS.Placeholder > * {\n    display:block; position:absolute;\n    left:50%; top:50%;\n    transform:translate(-55%,-50%);\n    white-space:nowrap;\n  }\n\n/**** custom Dialogs ****/\n\n  .PUX.Dialog > .ContentPane {\n    position:absolute; left:0px; top:30px; right:0px; bottom:0px;\n  }\n  .PUX.ResizableDialog > .ContentPane {\n    position:absolute; left:0px; top:30px; right:0px; bottom:10px;\n  }\n",document.head.appendChild(T);class O extends S{constructor(...e){super(...e),this._Board=void 0,this._Mode="enclose",this._StickerList=[],this._pointedSticker=void 0,this._selectedStickers=[],this._SelectionLimit=Infinity,this._LassoStart=void 0,this._LassoEnd=void 0,this._SelectionBeforeLasso=[],this._ShapeMode=void 0,this._shapedStickers=void 0,this._initialGeometries=void 0,this._SnapToGrid=!1,this._GridWidth=1,this._GridHeight=1,this._StickerRecognizerSlot={},this._ShapeHandleRecognizerSlot={},this._LassoRecognizerSlot={},this.state={Value:0}}_mountBoard(e){null!=e&&null!=this.base&&(e._View=this.base,null!=e._onMount&&e._onMount()),this._Board=e}_unmountBoard(){const e=this._Board;null!=e&&(e._View=void 0,null!=e._onUnmount&&e._onUnmount())}componentDidMount(){this._mountBoard(this._Board)}componentWillUnmount(){this._unmountBoard()}rerender(e){this.setState({Value:this.state.Value+1})}render(l){const u=this;let{PUX:S,Classes:m,Board:k,StickerList:f,Placeholder:$,Mode:L,SelectionLimit:H,selectedStickers:z,onSelectionChange:W,onStickerSelected:B,onStickerDeselected:R,SelectionFrameStyle:T,SelectionHandleStyle:O,LassoMode:K,onGeometryChange:j,SnapToGrid:Z,GridWidth:q,GridHeight:J}=l;function Q(){u._pointedSticker=void 0,u._shapedStickers=void 0,u._initialGeometries=void 0}function Y(){null!=u._shapedStickers&&se(u._shapedStickers,u._initialGeometries),Q()}this._Board!==k&&(this._unmountBoard(),this._mountBoard(k)),e("board CSS class names",m),d("board",k),t("sticker list",f,c),e("placeholder text",$),n("board mode",L,["edit","run"]),i("selection limit",H),t("list of selected stickers",z,c),o("selection change callback",W),o("selection callback",B),o("deselection callback",R),e("selection frame CSS style",T),r("selection handle CSS style",O),n("lasso selection mode",K,["touch","enclose"]),o("geometry change callback",j),s('"SnapToGrid" mode',Z),a("grid width",q),a("grid height",J),null==m&&(m=""),null==$&&($="(empty)"),null==L&&(L="run"),null==H&&(H=Infinity),null==z&&(z=[]),null==O&&(O="background:orangered; border:solid 1px darkgray"),null==K&&(K="enclose"),null==Z&&(Z=!1),null==q&&(q=10),null==J&&(J=10);const ee=new Set;function te(e,t=[]){const n=e.slice();t.forEach(e=>{n.indexOf(e)<0&&n.push(e)}),z.length>u._SelectionLimit&&(n.length=u._SelectionLimit);const i=[],o=[];n.forEach(e=>{u._selectedStickers.indexOf(e)<0&&i.push(e)}),u._selectedStickers.forEach(e=>{n.indexOf(e)<0&&o.push(e)}),z=u._selectedStickers=n,(i.length>0||o.length>0)&&(Y(),null!=W&&W(z)),o.length>0&&null!=R&&o.forEach(e=>{R(e)}),i.length>0&&null!=B&&i.forEach(e=>{B(e)})}function ne(e){return u._selectedStickers.indexOf(e)>=0}function ie(){const{x:e,y:t}=u._LassoStart,{x:n,y:i}=u._LassoEnd||u._LassoStart;return{x:e<=n?e:n,y:t<=i?t:i,Width:e<=n?n-e:e-n,Height:t<=i?i-t:t-i}}function oe(e,t,n){u._LassoEnd={x:e,y:t},te(n?u._SelectionBeforeLasso:[],function(){let{x:e,y:t,Width:n,Height:i}=ie(),o=e+n,r=t+i;return u._StickerList.filter("touch"===K?n=>{if(!n.isVisible||n.isLocked)return!1;if("run"===u._Mode&&!n.isSelectable)return!1;const{x:i,y:s,Width:a,Height:l}=n.Geometry;return e<=i+a&&i<=o&&t<=s+l&&s<=r}:n=>{if(!n.isVisible||n.isLocked)return!1;if("run"===u._Mode&&!n.isSelectable)return!1;const{x:i,y:s,Width:a,Height:l}=n.Geometry;return e<=i&&i+a<=o&&t<=s&&s+l<=r})}())}z=z.filter(e=>c(e)&&!ee.has(e)?(ee.add(e),!0):(Y(),!1)),z.length>H&&te(z.slice(0,H)),u._Mode=L,u._StickerList=f,u._selectedStickers=z,u._SelectionLimit=H,u._SnapToGrid=Z,u._GridWidth=q,u._GridHeight=J;const re=g(u._LassoRecognizerSlot,{onlyFrom:".SNS.BoardView,.SNS.Sticker,.SNS.Sticker *",neverFrom:".SNS.Sticker.selectable,.SNS.Sticker.selectable *",Threshold:4,onDragStarted:(e,t,n,i,o)=>{u._SelectionBeforeLasso=u._selectedStickers.slice(),({left:e,top:t}=V("local",{left:e,top:t},u.base)),u._LassoStart={x:e,y:t},oe(e,t,o.shiftKey||o.metaKey),u.rerender()},onDragContinued:(e,t,n,i,o)=>{oe(u._LassoStart.x+n,u._LassoStart.y+i,o.shiftKey||o.metaKey),u.rerender()},onDragFinished:(e,t,n,i,o)=>{oe(u._LassoStart.x+n,u._LassoStart.y+i,o.shiftKey||o.metaKey),u._LassoStart=u._LassoEnd=void 0,u._SelectionBeforeLasso=[],u.rerender()},onDragCancelled:(e,t,n,i)=>{u._LassoStart=u._LassoEnd=void 0,te(u._SelectionBeforeLasso),u._SelectionBeforeLasso=[],u.rerender()},onClicked:function(){te([])}});function se(e,t){null!=j&&(j(e,t),u.rerender())}function ae(e,t,n,i,o){if(null==j)return;let r=0,s=0,a=0,l=0;switch(t){case"nw":r=n,a=-n,s=i,l=-i;break;case"n":s=i,l=-i;break;case"ne":a=n,s=i,l=-i;break;case"e":a=n;break;case"se":a=n,l=i;break;case"s":l=i;break;case"sw":r=n,a=-n,l=i;break;case"w":r=n,a=-n;break;case"c":r=n,s=i}null==o&&(o=u._initialGeometries),se(e,o.map(e=>{let n=Math.max(0,e.Width+a),i=Math.max(0,e.Height+l),o=e.x+r,d=o+n,c=e.y+s,h=c+i;if(u._SnapToGrid){let e=u._GridWidth*Math.round(o/u._GridWidth),r=u._GridWidth*Math.round(d/u._GridWidth),s=u._GridHeight*Math.round(c/u._GridHeight),a=u._GridHeight*Math.round(h/u._GridHeight);switch(t){case"nw":o=Math.min(e,d),c=Math.min(s,h);break;case"n":c=Math.min(s,h);break;case"ne":d=Math.max(o,r),c=Math.min(s,h);break;case"e":d=Math.max(o,r);break;case"se":d=Math.max(o,r),h=Math.max(c,a);break;case"s":h=Math.max(c,a);break;case"sw":o=Math.min(e,d),h=Math.max(c,a);break;case"w":o=Math.min(e,d);break;case"c":o=e,d=o+n,c=s,h=c+i}}return{x:o,y:c,Width:d-o,Height:h-c}}))}const le=(e,t,n)=>{if(0===H)return;const i=u._pointedSticker;let o,r,s=!1;n.shiftKey||n.metaKey?(s=!0,ne(i)?(r=[i],z=z.filter(e=>e!==i)):(z.length===H&&(r=[z.shift()]),o=[i],z.push(i))):(r=z.filter(e=>e!==i),s=!ne(i),o=s?[i]:[],z=[i]),s&&null!=W&&W(z),null!=r&&null!=R&&r.forEach(e=>{R(e)}),null!=o&&null!=B&&o.forEach(e=>{B(e)}),s&&u.rerender()},de=g(u._StickerRecognizerSlot,{onlyFrom:".SNS.Cover",Threshold:4,onDragStarted:(e,t,n,i,o)=>{ne(u._pointedSticker)||(o.shiftKey||o.metaKey?te([u._pointedSticker],u._selectedStickers):te([u._pointedSticker])),u._shapedStickers=u._selectedStickers,u._initialGeometries=u._selectedStickers.map(e=>e.Geometry),ae(u._shapedStickers,"c",n,i)},onDragContinued:(e,t,n,i)=>{null!=u._shapedStickers&&ae(u._shapedStickers,"c",n,i)},onDragFinished:(e,t,n,i)=>{null!=u._shapedStickers&&(ae(u._shapedStickers,"c",n,i),Q())},onDragCancelled:(e,t,n,i)=>{Y()},onClicked:le}),ce=_(u._ShapeHandleRecognizerSlot,{onlyFrom:".SNS.ShapeHandle",Threshold:0,onDragStarted:(e,t,n,i)=>{u._shapedStickers=u._selectedStickers,u._initialGeometries=u._selectedStickers.map(e=>e.Geometry),ae(u._shapedStickers,u._ShapeMode,n,i)},onDragContinued:(e,t,n,i)=>{null!=u._shapedStickers&&ae(u._shapedStickers,u._ShapeMode,n,i)},onDragFinished:(e,t,n,i)=>{null!=u._shapedStickers&&(ae(u._shapedStickers,u._ShapeMode,n,i),Q())},onDragCancelled:(e,t,n,i)=>{Y()}});function he(e,t){u._ShapeMode=t,ce(e)}const ue=new WeakMap,Se=null==k?void 0:h(k);return p(M||(M=F`<div class="SNS BoardView ${0}" style=${0}
        onPointerDown=${0} onPointerMove=${0}
        onPointerUp=${0} onPointerCancel=${0}
      >
        ${0}

        ${0}

        ${0}
        ${0}
        ${0}
        ${0}
        ${0}
      </div>`),m,Se,re,re,re,re,null==k?p(w||(w=F`<div class="SNS Placeholder"><div>(no Board to show)</div></div>`)):null==f?p(D||(D=F`<div class="SNS Placeholder"><div>(no Stickers to show)</div></div>`)):f.map(e=>{if(!e.isVisible)return"";const t=e.Geometry,n=e.isSelectable,i=ne(e);return p(C||(C=F`<${0} Sticker=${0} key=${0}
                  selected=${0}
                  SelectionFrameStyle=${0}
                  Geometry=${0}
                  selectable=${0}
                  builtinDragging=${0}
                  builtinSelection=${0}
                />`),U,e,e.Id,i&&"run"===L,T,t,n,n&&function(e){let t=ue.get(e);return null==t&&ue.set(e,t=g(e,{onlyFrom:".builtinDraggable",neverFrom:".notBuiltinDraggable",Threshold:4,onDragStarted:(t,n,i,o,r)=>{u._pointedSticker=e,ne(u._pointedSticker)||(r.shiftKey||r.metaKey?te([u._pointedSticker],u._selectedStickers):te([u._pointedSticker])),u._shapedStickers=u._selectedStickers,u._initialGeometries=u._selectedStickers.map(e=>e.Geometry),ae(u._shapedStickers,"c",i,o)},onDragContinued:(e,t,n,i)=>{null!=u._shapedStickers&&ae(u._shapedStickers,"c",n,i)},onDragFinished:(e,t,n,i)=>{null!=u._shapedStickers&&(ae(u._shapedStickers,"c",n,i),Q())},onDragCancelled:(e,t,n,i)=>{Y()},onClicked:(t,n,i)=>{u._pointedSticker=e,le(0,0,i)}})),t}(e),n&&function(e){return function(t){u._pointedSticker=e,le(0,0,t)}}(e))}),null!=f&&"edit"===L?f.map(e=>{if(!e.isVisible)return"";const t=ne(e);return p(G||(G=F`
                <${0} Sticker=${0} key=${0}
                  selected=${0}
                  onPointerEvent=${0}
                />
              `),I,e,e.Id+"c",t,t=>function(e,t){u._ShapeMode="c",u._pointedSticker=t,de(e)}(t,e))}):"",z.length>0?z.filter(e=>e.isVisible).map(e=>{const t=e.Id,n=e.Geometry;return p(E||(E=F`
                <${0} key=${0} Mode="nw" Geometry=${0}
                  onPointerEvent=${0}/>
                <${0} key=${0}  Mode="n"  Geometry=${0}
                  onPointerEvent=${0}/>
                <${0} key=${0} Mode="ne" Geometry=${0}
                  onPointerEvent=${0}/>
                <${0} key=${0}  Mode="e"  Geometry=${0}
                  onPointerEvent=${0}/>
                <${0} key=${0} Mode="se" Geometry=${0}
                  onPointerEvent=${0}/>
                <${0} key=${0}  Mode="s"  Geometry=${0}
                  onPointerEvent=${0}/>
                <${0} key=${0} Mode="sw" Geometry=${0}
                  onPointerEvent=${0}/>
                <${0} key=${0}  Mode="w"  Geometry=${0}
                  onPointerEvent=${0}/>
              `),X,t+"nw",n,e=>he(e,"nw"),X,t+"n",n,e=>he(e,"n"),X,t+"ne",n,e=>he(e,"ne"),X,t+"e",n,e=>he(e,"e"),X,t+"se",n,e=>he(e,"se"),X,t+"s",n,e=>he(e,"s"),X,t+"sw",n,e=>he(e,"sw"),X,t+"w",n,e=>he(e,"w"))}):"",null==this._LassoStart?"":p(P||(P=F`<div class="SNS Lasso" style=${0}></>`),function(){const{x:e,y:t,Width:n,Height:i}=ie();return`left:${e}px; top:${t}px; width:${n}px; height:${i}px`}()),function(){if(null==u._shapedStickers)return"";const e={},t={};u._StickerList.filter(e=>!ne(e)).forEach(n=>{const{y:i,Height:o}=n.Geometry,r=Math.round(i),s=Math.round(i+o/2),a=Math.round(i+o);e[r]=e[a]=!0,t[s]=!0});const n={};u._shapedStickers.forEach(i=>{const{y:o,Height:r}=i.Geometry,s=Math.round(o),a=Math.round(o+r/2),l=Math.round(o+r);e[s]&&(n[s]="Edge"),e[a]&&"Edge"!==n[a]&&(n[a]="Center"),e[l]&&(n[l]="Edge"),t[s]&&"Edge"!==n[s]&&(n[s]="Center"),t[a]&&"Edge"!==n[a]&&(n[a]="Center"),t[l]&&"Edge"!==n[l]&&(n[l]="Center")});const i=[];for(let e in n)null!=n[e]&&i.push(e);return p(x||(x=F`${0}`),i.map(e=>p(b||(b=F`
          <div class="SNS horizontalGuide ${0}" style="top:${0}px"/>
        `),n[e],e)))}(),function(){if(null==u._shapedStickers)return"";const e={},t={};u._StickerList.filter(e=>!ne(e)).forEach(n=>{const{x:i,Width:o}=n.Geometry,r=Math.round(i),s=Math.round(i+o/2),a=Math.round(i+o);e[r]=e[a]=!0,t[s]=!0});const n={};u._shapedStickers.forEach(i=>{const{x:o,Width:r}=i.Geometry,s=Math.round(o),a=Math.round(o+r/2),l=Math.round(o+r);e[s]&&(n[s]="Edge"),e[a]&&"Edge"!==n[a]&&(n[a]="Center"),e[l]&&(n[l]="Edge"),t[s]&&"Edge"!==n[s]&&(n[s]="Center"),t[a]&&"Edge"!==n[a]&&(n[a]="Center"),t[l]&&"Edge"!==n[l]&&(n[l]="Center")});const i=[];for(let e in n)null!=n[e]&&i.push(e);return p(y||(y=F`${0}`),i.map(e=>p(v||(v=F`
          <div class="SNS verticalGuide ${0}" style="left:${0}px"/>
        `),n[e],e)))}(),null==k?"":k.DialogList.map(e=>p(N||(N=F`<${0} key=${0} PUX=${0} Board=${0} Dialog=${0}/>`),A,e.Id,S,k,e)))}}class U extends S{constructor(...e){super(...e),this._Sticker=void 0}componentDidMount(){const e=this._Sticker;e._View=this.base,null!=e._onMount&&e._onMount()}componentWillUnmount(){const e=this._Sticker;e._View=void 0,null!=e._onUnmount&&e._onUnmount()}render(e){let{Sticker:t,selectable:n,selected:o,SelectionFrameStyle:r,Geometry:s,builtinSelection:a,builtinDragging:d}=e;this._Sticker=t;let{x:c,y:u,Width:S,Height:g}=s;l("sticker x position",c),l("sticker y position",u),i("sticker width",S),i("sticker height",g);const _=null!=c&&null!=S&&null!=u&&null!=g?`left:${c}px; top:${u}px; width:${S}px; height:${g}px; right:auto; bottom:auto;`:"";return p(L||(L=F`<div class="
        SNS Sticker ${0} ${0}
      " style="
        ${0};
        ${0}
        ${0}
      ">
        ${0}
      </div>`),n?"selectable":"",o?"selected":"",_,o&&null!=r?`outline:${r};`:"",h(t)||"",n?t.Rendering({builtinSelection:a,builtinDragging:d}):t.Rendering())}}class I extends S{render(e){let{Sticker:t,onPointerEvent:n}=e,i=k(e,f),{x:o,y:r,Width:s,Height:a}=t.Geometry;const l=null!=o&&null!=s&&null!=r&&null!=a?`left:${o}px; top:${r}px; width:${s}px; height:${a}px; right:auto; bottom:auto;`:"";return p(H||(H=F`<div class="SNS Cover" style="
        ${0} ${0}
      " ...${0}
        onPointerDown=${0} onPointerMove=${0}
        onPointerUp=${0} onPointerCancel=${0}
      />`),l,t.isLocked?"pointer-events:none":"",i,n,n,n,n)}}const K={x:-Number.MAX_SAFE_INTEGER,Width:320,y:-Number.MAX_SAFE_INTEGER,Height:240};class A extends S{constructor(...e){super(...e),this._DragRecognizer=void 0,this._Geometry=K,this._DragMode=void 0,this._DragOffset=K,this.state={Value:0}}rerender(){this.setState({Value:this.state.Value+1})}render(e){const{PUX:t,Board:n,Dialog:i}=e;if(0==i.Visibility)return"";let{Id:o,Name:r,Title:s,isResizable:a,x:l,y:d,Width:c,Height:h,minWidth:u,maxWidth:S,minHeight:g,maxHeight:k,Renderer:f,onClose:$}=i;c=Math.max(u,c),null!=S&&(c=Math.min(c,S)),h=Math.max(g,h),null!=k&&(h=Math.min(h,k)),l==-Number.MAX_SAFE_INTEGER&&(l=Math.max(0,(window.innerWidth-c)/2)),d==-Number.MAX_SAFE_INTEGER&&(d=Math.max(0,(window.innerHeight-h)/2)),l=Math.min(l,window.innerWidth-40),d=Math.max(0,Math.min(d,window.innerHeight-30));const x=this;x._Geometry={x:l,y:d,Width:c,Height:h};const b=(e,t,o,r)=>{"drag"===x._DragMode?y(o,r):v(o,r),n.bringDialogToFront(i.Name),n.rerender()},y=(e,t)=>{n.positionDialogAt(i.Name,x._DragOffset.x+e,x._DragOffset.y+t)},v=(e,t)=>{let o=x._DragOffset.Width;switch(x._DragMode){case"resize-sw":o=Math.max(u,Math.min(x._DragOffset.Width-e,S||Infinity)),n.positionDialogAt(i.Name,x._DragOffset.x-(e=o-x._DragOffset.Width),x._DragOffset.y),o=x._DragOffset.Width+e;break;case"resize-se":o=Math.max(u,Math.min(x._DragOffset.Width+e,S||Infinity))}let r=Math.max(g,Math.min(x._DragOffset.Height+t,k||Infinity));n.sizeDialogTo(i.Name,o,r)};let M=x._DragRecognizer;null==M&&(M=x._DragRecognizer=_(this,{onlyFrom:".Titlebar,.leftResizer,.middleResizer,.rightResizer",neverFrom:".CloseButton",Threshold:4,onDragStarted:(e,t,n,i,o)=>{let r=o.target.classList;switch(x._DragMode=void 0,!0){case r.contains("leftResizer"):x._DragMode="resize-sw";break;case r.contains("middleResizer"):x._DragMode="resize-s";break;case r.contains("rightResizer"):x._DragMode="resize-se";break;default:x._DragMode="drag"}x._DragOffset=m({},x._Geometry),b(0,0,n,i)},onDragContinued:b,onDragFinished:b,onDragCancelled:b}));const w=`left:${l}px; top:${d}px; width:${c}px; height:${h}px; right:auto; bottom:auto;`;let D;try{D=f()}catch(e){console.error("Dialog rendering failed",e),D=p(z||(z=F`<div>(Dialog rendering failed)</div>`))}return p(W||(W=F`<div class="PUX ${0}Dialog" id=${0} style="
        position:fixed; ${0}
      ">
        <div class="ContentPane">${0}</div>

        <div class="Titlebar"
          onPointerDown=${0} onPointerUp=${0}
          onPointerMove=${0} onPointerCancel=${0}
        >
          <div class="Title">${0}</div>
          <img class="CloseButton" src="${0}/xmark.png"
            onClick=${0}/>
        </div>

        ${0}
      </>`),a?"Resizable":"",o,w,D,M,M,M,M,s,t._ImageFolder,function(e){e.stopImmediatePropagation(),e.preventDefault(),n.closeDialog(i.Name),null!=$&&$(r)},a?p(B||(B=F`
          <div class="leftResizer"
            onPointerDown=${0} onPointerUp=${0}
            onPointerMove=${0} onPointerCancel=${0}
          />
          <div class="middleResizer"
            onPointerDown=${0} onPointerUp=${0}
            onPointerMove=${0} onPointerCancel=${0}
          />
          <div class="rightResizer"
            onPointerDown=${0} onPointerUp=${0}
            onPointerMove=${0} onPointerCancel=${0}
          />
        `),M,M,M,M,M,M,M,M,M,M,M,M):"")}}class X extends S{render(e){let{Mode:t,Geometry:n,onPointerEvent:i}=e,o=k(e,$),{x:r,y:s,Width:a,Height:l}=n;const d=r-8,c=Math.round(r+a/2)-4,h=r+a,u=s-8,S=Math.round(s+l/2)-4,g=s+l;let _,m;switch(t){case"nw":_=`left:${d}px; top:${u}px;`,m="nwse";break;case"n":_=`left:${c}px; top:${u}px;`,m="ns";break;case"ne":_=`left:${h}px; top:${u}px;`,m="nesw";break;case"e":_=`left:${h}px; top:${S}px;`,m="ew";break;case"se":_=`left:${h}px; top:${g}px;`,m="nwse";break;case"s":_=`left:${c}px; top:${g}px;`,m="ns";break;case"sw":_=`left:${d}px; top:${g}px;`,m="nesw";break;case"w":_=`left:${d}px; top:${S}px;`,m="ew"}return m="cursor:"+m+"-resize",p(R||(R=F`<div class="SNS ShapeHandle" style="${0} ${0}" ...${0}
        onPointerDown=${0} onPointerMove=${0}
        onPointerUp=${0} onPointerCancel=${0}
      />`),_,m,o,i,i,i,i)}}window.SNS_BoardView=O,document.dispatchEvent(new CustomEvent("SNS_BoardView",{detail:window.SNS_BoardView}));export{O as SNS_BoardView};
//# sourceMappingURL=sns-boardview.modern.js.map
